= bootstrap_form_for [:editor, @post], layout: :horizontal, label_col: 'col-sm-2', control_col: 'col-sm-10' do |f|
  = f.text_field :title
  = f.text_area :body, data: {upload_path: editor_images_url}
  - if current_site.credit_enabled?
    = f.form_group label: {text: :credits} do
      = f.fields_for :credits do |ff|
        = render 'credit_fields', f: ff

      .links
        = link_to_add_association 'Add credit', f, :credits, class: 'btn btn-default pull-right'

  = f.collection_select :category_id, current_site.categories, :id, :name
  = f.collection_select :serial_id, current_site.serials, :id, :title, include_blank: true
  = f.file_field :thumbnail
  - if @post.thumbnail.present?
    = f.form_group do
      = image_tag @post.thumbnail_url, height: 80
  = f.datetime_local_field :published_at

  = f.form_group do
    = f.submit

:javascript
  $(function() {
    function applySelect2($element, options) {
      var default_options = {
        placeholder: '選択してください'
      }
      var merged_options = $.extend(default_options, options);
      $element.select2(merged_options);
    }

    applySelect2($('select#post_category_id'), {allowClear: false});
    applySelect2($('select#post_serial_id'), {allowClear: true});

    $(document).on('cocoon:after-insert', function(e, inserted) {
      applySelect2($(inserted[0]).find('select'), {allowClear: false});
    })
  });
